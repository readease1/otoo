<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841dea368412123be1b85e5_otto.png">
    <title>Otto - Just Another Day at the Office</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f4c604;
            font-family: 'Comic Neue', cursive;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        .nav-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #333;
            border-radius: 25px;
            padding: 8px 16px;
            font-family: 'Comic Neue', cursive;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        
        .nav-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .main-content {
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        
        .otto-container {
            margin-bottom: 30px;
            position: relative;
        }
        
        .otto-illustration {
            width: 400px;
            height: 400px;
            margin: 0 auto 20px;
            position: relative;
        }
        
        .otto-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            animation: float 3s ease-in-out infinite;
        }
        
        h1 {
            font-size: 72px;
            font-weight: 700;
            color: white;
            text-shadow: 4px 4px 0px #333;
            margin-bottom: 20px;
            letter-spacing: -2px;
        }
        
        .subtitle {
            font-size: 18px;
            color: #333;
            margin-bottom: 40px;
            font-style: italic;
        }
        
        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 30px;
            border-radius: 30px;
            font-family: 'Comic Neue', cursive;
            font-size: 18px;
            font-weight: 700;
            text-decoration: none;
            border: 3px solid #333;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 4px 0 #333;
        }
        
        .btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #333;
        }
        
        .btn-community {
            background: #4ecdc4;
            color: #333;
        }
        
        .btn-community:hover {
            background: #45b7b8;
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #333;
        }
        
        .btn-buy {
            background: linear-gradient(to right, #26de81 50%, white 50%);
            background-size: 100% 100%;
            color: #333;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .btn-buy::after {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            width: 3px;
            height: 100%;
            background: #1e7e34;
            transform: translateX(-50%);
            z-index: -1;
        }
        
        .btn-buy:hover {
            background: linear-gradient(to right, #20bf6b 50%, #f0f0f0 50%);
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #333;
        }
        
        .bottom-text {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid #333;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .copy-button {
            background: #4ecdc4;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 0 #333;
        }
        
        .copy-button:hover {
            background: #45b7b8;
            transform: translateY(-1px);
            box-shadow: 0 3px 0 #333;
        }
        
        .copy-button:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #333;
        }
        
        .copy-success {
            background: #26de81 !important;
        }
        
        .footer {
            font-size: 14px;
            color: #333;
            text-align: center;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
        }
        
        .footer a {
            color: #333;
            text-decoration: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        
        .modal-content {
            background-color: #f4c604;
            margin: 5% auto;
            padding: 30px;
            border: 4px solid #333;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            position: relative;
            font-family: 'Comic Neue', cursive;
        }
        
        .close {
            color: #333;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        .modal h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 28px;
        }
        
        .file-upload {
            background: white;
            border: 3px dashed #333;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-upload:hover {
            background: #f0f0f0;
            border-color: #ffa726;
        }
        
        .file-upload input {
            display: none;
        }
        
        .ottofy-preview {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }
        
        .ottofy-preview canvas {
            border: 3px solid #333;
            border-radius: 10px;
            max-width: 100%;
            cursor: grab;
        }
        
        .ottofy-preview canvas:active {
            cursor: grabbing;
        }
        
        .ottofy-controls {
            margin: 15px 0;
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .overlay-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .overlay-option {
            background: white;
            border: 3px solid #333;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Comic Neue', cursive;
            font-weight: 600;
        }
        
        .overlay-option.active {
            background: #4ecdc4;
            transform: translateY(-2px);
        }
        
        .overlay-option:hover {
            background: #f0f0f0;
        }
        
        .overlay-option.active:hover {
            background: #45b7b8;
        }
        
        .size-control {
            background: #4ecdc4;
            border: 2px solid #333;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .size-control:hover {
            background: #45b7b8;
            transform: scale(1.1);
        }
        
        .size-display {
            background: white;
            border: 2px solid #333;
            border-radius: 15px;
            padding: 5px 15px;
            font-family: 'Comic Neue', cursive;
            font-weight: 600;
            color: #333;
        }
        
        .game-modal .modal-content {
            width: 98%;
            max-width: 1300px;
            height: 95vh;
            padding: 15px;
            margin: 1% auto;
            overflow: hidden;
        }
        
        .game-iframe {
            width: 120%;
            height: calc(120% - 30px);
            border: 3px solid #333;
            border-radius: 10px;
            margin-top: -70px;
            margin-left: -10%;
            transform: translateY(-50px);
        }
        
        .gallery-modal .modal-content {
            width: 95%;
            max-width: 1000px;
            height: 85vh;
            padding: 20px;
            overflow-y: auto;
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .gallery-item {
            position: relative;
            background: white;
            border: 3px solid #333;
            border-radius: 15px;
            overflow: hidden;
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        
        .gallery-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }
        
        .gallery-item-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 15px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }
        
        .gallery-item:hover .gallery-item-overlay {
            transform: translateY(0);
        }
        
        .save-btn {
            background: #26de81;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 8px 15px;
            font-family: 'Comic Neue', cursive;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 10px;
        }
        
        .save-btn:hover {
            background: #20bf6b;
            transform: translateY(-2px);
        }
        
        .lightbox {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            cursor: pointer;
        }
        
        .lightbox-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
            border: 4px solid #333;
            border-radius: 15px;
        }
        
        .lore-modal .modal-content {
            width: 90%;
            max-width: 750px;
            height: 85vh;
            padding: 0;
            overflow: hidden;
            background: #f4c604;
            border: 4px solid #333;
            border-radius: 20px;
        }
        
        .lore-header {
            background: #333;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 16px 16px 0 0;
        }
        
        .lore-header h2 {
            font-size: 24px;
            margin: 0;
            font-family: 'Comic Neue', cursive;
        }
        
        .lore-content {
            padding: 20px;
            height: calc(100% - 80px);
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.9);
            margin: 15px;
            border-radius: 15px;
            border: 3px solid #333;
        }
        
        .story-section {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border: 2px solid #333;
            border-radius: 12px;
            border-left: 6px solid #4ecdc4;
        }
        
        .story-section h3 {
            color: #333;
            margin: 0 0 12px 0;
            font-size: 18px;
            font-family: 'Comic Neue', cursive;
            font-weight: 700;
        }
        
        .story-section p {
            margin: 0;
            color: #444;
            font-size: 15px;
            line-height: 1.5;
        }
        
        .story-section em {
            color: #666;
            font-style: italic;
            background: #f8f9fa;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .zap {
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .ending {
            background: #4ecdc4;
            color: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #333;
            text-align: center;
            margin-top: 20px;
            font-weight: 600;
        }
        
        .lightbox img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 11px;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @media (max-width: 768px) {
            .nav-buttons {
                position: relative;
                top: 0;
                right: 0;
                justify-content: center;
                margin-bottom: 20px;
            }
            
            .otto-illustration {
                width: 300px;
                height: 300px;
            }
            
            h1 {
                font-size: 48px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
        }
        
        // Typewriter effect
        const phrases = [
            '"Am I even qualified for this job?"',
            '"This is shocking... do I belong here?"',
            '"Maybe I should just stick to the deep sea..."',
            '"Everyone else seems so much more shocking than me"'
        ];
        
        let currentPhrase = 0;
        let currentChar = 0;
        let isDeleting = false;
        
        function typeWriter() {
            const typewriterElement = document.getElementById('typewriter');
            if (!typewriterElement) return;
            
            const current = phrases[currentPhrase];
            
            if (isDeleting) {
                typewriterElement.textContent = current.substring(0, currentChar - 1);
                currentChar--;
            } else {
                typewriterElement.textContent = current.substring(0, currentChar + 1);
                currentChar++;
            }
            
            let typeSpeed = isDeleting ? 50 : 100;
            
            if (!isDeleting && currentChar === current.length) {
                // Pause at end
                typeSpeed = 2000;
                isDeleting = true;
            } else if (isDeleting && currentChar === 0) {
                isDeleting = false;
                currentPhrase = (currentPhrase + 1) % phrases.length;
                typeSpeed = 500;
            }
            
            setTimeout(typeWriter, typeSpeed);
        }
        
        // Start typewriter effect immediately
        setTimeout(function() {
            typeWriter();
        }, 500);
    </style>
</head>
<body>
    <div class="nav-buttons">
        <button class="nav-btn" onclick="openOttofyModal()">OTTOFY</button>
        <button class="nav-btn" onclick="openGameModal()">PLAY</button>
        <button class="nav-btn" onclick="openGalleryModal()">OTTO GALLERY</button>
        <button class="nav-btn" onclick="openLoreModal()">OTTO LORE</button>
    </div>
    
    <div class="main-content">
        <div class="otto-container">
            <div class="otto-illustration">
                <img src="https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6842428a8b7d1ec5984a1546_ottot.gif" alt="Otto the Octopus" class="otto-image">
            </div>
        </div>
        
        <h1>otto</h1>
        <p class="subtitle">"This is shocking... do I belong here?"</p>
        
        <div class="action-buttons">
    <a href="https://twitter.com/" class="btn btn-community" target="_blank">Join Community</a>
    <a href="https://pump.fun/" class="btn btn-buy" target="_blank">buy $otto</a>
</div>
        
        <div class="bottom-text">
            CA: <span id="contract-address">TBA</span>
            <button id="copy-btn" class="copy-button" onclick="copyToClipboard()">üìã</button>
        </div>
    </div>
    
    <div class="footer">
        otto ¬© 2025 | <a href="mailto:team@otto.link">team@otto.link</a>
    </div>
    
    <!-- Ottofy Modal -->
    <div id="ottofyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeOttofyModal()">&times;</span>
            <h2>OTTOFY Your Profile Picture!</h2>
            <p>Upload your profile picture and Otto will make it more... Otto-like! üêô</p>
            
            <div class="file-upload" onclick="document.getElementById('imageInput').click()">
                <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
                <p><strong>Click here to upload your image</strong></p>
                <p>Supports JPG, PNG, GIF</p>
            </div>
            
            <div class="overlay-selector">
                <button class="overlay-option active" onclick="selectOverlay('otto')">üêô Otto</button>
                <button class="overlay-option" onclick="selectOverlay('ink')">üñ§ Ink Splatter</button>
            </div>
            
            <div class="ottofy-preview" id="ottofyPreview" style="display: none;">
                <canvas id="ottofyCanvas" width="400" height="400"></canvas>
                <div class="ottofy-controls">
                    <button class="size-control" onclick="changeOverlaySize(-0.1)">-</button>
                    <span class="size-display" id="sizeDisplay">100%</span>
                    <button class="size-control" onclick="changeOverlaySize(0.1)">+</button>
                </div>
                <p style="font-size: 14px; color: #666; margin: 10px 0;">Drag the overlay to move it around!</p>
                <button class="nav-btn" onclick="downloadOttofiedImage()">Download Styled PFP!</button>
            </div>
        </div>
    </div>
    
    <!-- Game Modal -->
    <div id="gameModal" class="modal game-modal">
        <div class="modal-content">
            <span class="close" onclick="closeGameModal()">&times;</span>
            <iframe id="gameFrame" class="game-iframe" src="about:blank"></iframe>
        </div>
    </div>
    
    <!-- Gallery Modal -->
    <div id="galleryModal" class="modal gallery-modal">
        <div class="modal-content">
            <span class="close" onclick="closeGalleryModal()">&times;</span>
            <p>Otto's various moods and moments captured in art!</p>
            
            <div class="gallery-grid" id="galleryGrid">
                <!-- Gallery items will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Lore Modal -->
    <div id="loreModal" class="modal lore-modal">
        <div class="modal-content">
            <span class="close" onclick="closeLoreModal()">&times;</span>
            
            <div class="lore-header">
                <h2>Otto's Story üêô</h2>
            </div>
            
            <div class="lore-content">
                <div class="story-section">
                    <h3>The Dream</h3>
                    <p>Otto grew up in the deep sea watching corporate life through old magazines that sank to the ocean floor. He thought <em>"How hard could office work be?"</em> Turns out, pretty hard when you accidentally electrocute your coworkers.</p>
                </div>
                
                <div class="story-section">
                    <h3>First Day Disasters</h3>
                    <p>SeaScale Marketing, day one. Otto's presenting to the board when his nerves kick in. <span class="zap">ZAP!</span> Every electronic in the room dies. The CEO's laptop, the projector, even the coffee machine. Otto hides in the supply closet for the rest of the day.</p>
                </div>
                
                <div class="story-section">
                    <h3>Customer Service Nightmare</h3>
                    <p>AquaTech Solutions seemed safer. Phone support, minimal electricity needed. Wrong. Every angry customer call made Otto's stress spike and <span class="zap">ZAP!</span> - dead phone line. His supervisor kept asking about the "electrical issues" at his desk.</p>
                </div>
                
                <div class="story-section">
                    <h3>The Latte Lightning Incident</h3>
                    <p>Desperate times at Tentacle Caf√©. Morning rush, one complaining customer, and Otto's defensive shock traveled straight through the espresso machine. Every coffee for the next hour tasted like... well, electricity. Fired that same day.</p>
                </div>
                
                <div class="story-section">
                    <h3>Remote Work Glitches</h3>
                    <p>After 17 failed jobs, Otto tried working from his underwater cave. Even video calls weren't safe - his stress made cameras glitch. Coworkers nicknamed him <em>"Otto the Glitch"</em> behind his back.</p>
                </div>
                
                <div class="story-section">
                    <h3>Finding His Spark</h3>
                    <p>Then Otto realized something: maybe being "shocking" wasn't a bug, it was a feature. Maybe the right job would appreciate an octopus who literally brings electricity to work. Maybe impostor syndrome was just his brain protecting him from places that didn't deserve his unique talents.</p>
                </div>
                
                <div class="ending">
                    Otto's still figuring it out, one shocking day at a time ‚ö°
                </div>
            </div>
        </div>
    </div>
    
    <!-- Lightbox for full-size images -->
    <div id="lightbox" class="lightbox" onclick="closeLightbox()">
        <div class="lightbox-content">
            <img id="lightboxImage" src="" alt="Otto Gallery Image">
        </div>
    </div>
    
    <script>
        function copyToClipboard() {
            const contractAddress = document.getElementById('contract-address').textContent;
            const copyBtn = document.getElementById('copy-btn');
            
            navigator.clipboard.writeText(contractAddress).then(function() {
                copyBtn.classList.add('copy-success');
                copyBtn.textContent = '‚úì';
                
                setTimeout(() => {
                    copyBtn.classList.remove('copy-success');
                    copyBtn.textContent = 'üìã';
                }, 2000);
            }).catch(function(err) {
                console.error('Could not copy text: ', err);
            });
        }
        
        function openOttofyModal() {
            document.getElementById('ottofyModal').style.display = 'block';
        }
        
        function closeOttofyModal() {
            document.getElementById('ottofyModal').style.display = 'none';
            document.getElementById('ottofyPreview').style.display = 'none';
        }
        
        function openGameModal() {
            document.getElementById('gameModal').style.display = 'block';
            document.getElementById('gameFrame').src = 'https://www.testtubegames.com/shocktopus_web.html';
        }
        
        function closeGameModal() {
            document.getElementById('gameModal').style.display = 'none';
            document.getElementById('gameFrame').src = 'about:blank';
        }
        
        function openGalleryModal() {
            document.getElementById('galleryModal').style.display = 'block';
            loadGallery();
        }
        
        function closeGalleryModal() {
            document.getElementById('galleryModal').style.display = 'none';
        }
        
        function openLoreModal() {
            document.getElementById('loreModal').style.display = 'block';
        }
        
        function closeLoreModal() {
            document.getElementById('loreModal').style.display = 'none';
        }
        
        function loadGallery() {
            const galleryImages = [
                'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841ef9ebcc6af5842f61da3_ChatGPT%20Image%20Jun%205%2C%202025%2C%2007_27_39%20PM.png',
                'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841ef9e77215441cd58f087_ChatGPT%20Image%20Jun%205%2C%202025%2C%2007_24_00%20PM.png',
                'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841ef9ea135842984700e78_ChatGPT%20Image%20Jun%205%2C%202025%2C%2007_27_05%20PM.png',
                'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841ef9e70f07bcf4dbb6db6_Jun%205%2C%202025%2C%2007_30_44%20PM.png',
                'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841ef9e172ae08cab6cb21d_ChatGPT%20Image%20Jun%205%2C%202025%2C%2007_31_27%20PM.png',
                'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841ef9eb252666f1cc96d10_ChatGPT%20Image%20Jun%205%2C%202025%2C%2007_33_22%20PM.png',
                'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841ef9e7face1b6e74d1e96_Jun%205%2C%202025%2C%2007_30_38%20PM.png',
                'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841ef9f2c7737003a9a7699_ChatGPT%20Image%20Jun%205%2C%202025%2C%2007_36_27%20PM.png',
                'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6841ef9fe9ad525551012266_ChatGPT%20Image%20Jun%205%2C%202025%2C%2007_34_32%20PM.png'
            ];
            
            const randomNames = [
                'otto-monday-blues',
                'tentacle-chaos',
                'imposter-vibes',
                'otto-overthinking',
                'workplace-anxiety',
                'deep-sea-doubts',
                'otto-stressed',
                'electric-feels',
                'octopus-overload'
            ];
            
            const galleryGrid = document.getElementById('galleryGrid');
            galleryGrid.innerHTML = '';
            
            galleryImages.forEach((imageUrl, index) => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'gallery-item';
                galleryItem.innerHTML = `
                    <img src="${imageUrl}" alt="Otto Gallery Image ${index + 1}" loading="lazy">
                    <div class="gallery-item-overlay">
                        <p>${randomNames[index]}</p>
                        <button class="save-btn" onclick="saveImage('${imageUrl}', '${randomNames[index]}')">Save Image</button>
                    </div>
                `;
                
                galleryItem.onclick = function(e) {
                    if (!e.target.classList.contains('save-btn')) {
                        openLightbox(imageUrl);
                    }
                };
                
                galleryGrid.appendChild(galleryItem);
            });
        }
        
        function saveImage(imageUrl, filename) {
            fetch(imageUrl)
                .then(response => response.blob())
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = filename + '.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    window.URL.revokeObjectURL(url);
                })
                .catch(err => {
                    console.error('Error downloading image:', err);
                    // Fallback to original method if fetch fails
                    const link = document.createElement('a');
                    link.href = imageUrl;
                    link.download = filename + '.png';
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
        }
        
        function openLightbox(imageUrl) {
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightboxImage');
            lightboxImage.src = imageUrl;
            lightbox.style.display = 'block';
        }
        
        function closeLightbox() {
            document.getElementById('lightbox').style.display = 'none';
        }
        
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                ottofyImage(e.target.result);
            };
            reader.readAsDataURL(file);
        }
        
        function ottofyImage(imageSrc) {
            const canvas = document.getElementById('ottofyCanvas');
            const ctx = canvas.getContext('2d');
            
            // Initialize overlay state
            window.overlayState = {
                x: canvas.width - 120,
                y: canvas.height - 120,
                size: 1.0,
                isDragging: false,
                dragOffset: { x: 0, y: 0 },
                currentOverlay: 'otto'
            };
            
            // Create new image with CORS handling
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                // Store the user image for redrawing
                window.userImage = img;
                loadOverlayImages();
            };
            
            img.onerror = function() {
                // Fallback: load image without CORS
                const fallbackImg = new Image();
                fallbackImg.onload = function() {
                    window.userImage = fallbackImg;
                    loadOverlayImages();
                };
                fallbackImg.src = imageSrc;
            };
            
            img.src = imageSrc;
        }
        
        function loadOverlayImages() {
            // Load Otto overlay
            const ottoImg = new Image();
            ottoImg.crossOrigin = 'anonymous';
            ottoImg.onload = function() {
                window.ottoOverlay = ottoImg;
                loadInkOverlay();
            };
            ottoImg.src = 'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/684240e0267bdf8ae22002bf_ChatGPT%20Image%20Jun%206%2C%202025%2C%2002_14_03%20AM.png';
        }
        
        function loadInkOverlay() {
            // Load ink overlay
            const inkImg = new Image();
            inkImg.crossOrigin = 'anonymous';
            inkImg.onload = function() {
                window.inkOverlay = inkImg;
                redrawCanvas();
                setupCanvasInteraction();
                document.getElementById('ottofyPreview').style.display = 'block';
                updateSizeDisplay();
            };
            inkImg.src = 'https://cdn.prod.website-files.com/6740d85c4e3daeef29a89470/6842436723c8b2dc8b1ff03a_ink%20(2).png';
        }
        
        function selectOverlay(type) {
            window.overlayState.currentOverlay = type;
            
            // Update button states
            document.querySelectorAll('.overlay-option').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            redrawCanvas();
        }
        
        function redrawCanvas() {
            const canvas = document.getElementById('ottofyCanvas');
            const ctx = canvas.getContext('2d');
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw user image
            ctx.drawImage(window.userImage, 0, 0, canvas.width, canvas.height);
            
            // Draw current overlay
            const overlaySize = 100 * window.overlayState.size;
            ctx.globalAlpha = 0.9;
            
            if (window.overlayState.currentOverlay === 'otto' && window.ottoOverlay) {
                ctx.drawImage(window.ottoOverlay, window.overlayState.x, window.overlayState.y, overlaySize, overlaySize);
            } else if (window.overlayState.currentOverlay === 'ink' && window.inkOverlay) {
                ctx.drawImage(window.inkOverlay, window.overlayState.x, window.overlayState.y, overlaySize, overlaySize);
            }
            
            ctx.globalAlpha = 1.0;
        }
        
        function setupCanvasInteraction() {
            const canvas = document.getElementById('ottofyCanvas');
            
            canvas.addEventListener('mousedown', function(e) {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Check if click is on overlay
                const overlaySize = 100 * window.overlayState.size;
                if (x >= window.overlayState.x && x <= window.overlayState.x + overlaySize &&
                    y >= window.overlayState.y && y <= window.overlayState.y + overlaySize) {
                    window.overlayState.isDragging = true;
                    window.overlayState.dragOffset.x = x - window.overlayState.x;
                    window.overlayState.dragOffset.y = y - window.overlayState.y;
                    canvas.style.cursor = 'grabbing';
                }
            });
            
            canvas.addEventListener('mousemove', function(e) {
                if (window.overlayState.isDragging) {
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    window.overlayState.x = x - window.overlayState.dragOffset.x;
                    window.overlayState.y = y - window.overlayState.dragOffset.y;
                    
                    // Keep overlay within canvas bounds
                    const overlaySize = 100 * window.overlayState.size;
                    window.overlayState.x = Math.max(0, Math.min(canvas.width - overlaySize, window.overlayState.x));
                    window.overlayState.y = Math.max(0, Math.min(canvas.height - overlaySize, window.overlayState.y));
                    
                    redrawCanvas();
                } else {
                    // Check if hovering over overlay
                    const rect = canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const overlaySize = 100 * window.overlayState.size;
                    
                    if (x >= window.overlayState.x && x <= window.overlayState.x + overlaySize &&
                        y >= window.overlayState.y && y <= window.overlayState.y + overlaySize) {
                        canvas.style.cursor = 'grab';
                    } else {
                        canvas.style.cursor = 'default';
                    }
                }
            });
            
            canvas.addEventListener('mouseup', function() {
                window.overlayState.isDragging = false;
                canvas.style.cursor = 'default';
            });
            
            canvas.addEventListener('mouseleave', function() {
                window.overlayState.isDragging = false;
                canvas.style.cursor = 'default';
            });
        }
        
        function changeOverlaySize(delta) {
            window.overlayState.size = Math.max(0.3, Math.min(2.0, window.overlayState.size + delta));
            
            // Keep overlay within bounds after size change
            const canvas = document.getElementById('ottofyCanvas');
            const overlaySize = 100 * window.overlayState.size;
            window.overlayState.x = Math.max(0, Math.min(canvas.width - overlaySize, window.overlayState.x));
            window.overlayState.y = Math.max(0, Math.min(canvas.height - overlaySize, window.overlayState.y));
            
            redrawCanvas();
            updateSizeDisplay();
        }
        
        function updateSizeDisplay() {
            const percentage = Math.round(window.overlayState.size * 100);
            document.getElementById('sizeDisplay').textContent = percentage + '%';
        }
        
        function downloadOttofiedImage() {
            const canvas = document.getElementById('ottofyCanvas');
            
            try {
                // Try direct canvas download first
                const link = document.createElement('a');
                link.download = `styled-pfp-${window.overlayState.currentOverlay}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (error) {
                // Fallback: Use html2canvas-like approach
                console.log('Direct download failed, using alternative method');
                
                // Create a new canvas to avoid tainted canvas issues
                const newCanvas = document.createElement('canvas');
                const newCtx = newCanvas.getContext('2d');
                newCanvas.width = canvas.width;
                newCanvas.height = canvas.height;
                
                // Redraw everything on the new canvas
                newCtx.drawImage(window.userImage, 0, 0, newCanvas.width, newCanvas.height);
                
                const overlaySize = 100 * window.overlayState.size;
                newCtx.globalAlpha = 0.9;
                
                if (window.overlayState.currentOverlay === 'otto' && window.ottoOverlay) {
                    newCtx.drawImage(window.ottoOverlay, window.overlayState.x, window.overlayState.y, overlaySize, overlaySize);
                } else if (window.overlayState.currentOverlay === 'ink' && window.inkOverlay) {
                    newCtx.drawImage(window.inkOverlay, window.overlayState.x, window.overlayState.y, overlaySize, overlaySize);
                }
                
                newCtx.globalAlpha = 1.0;
                
                // Download the new canvas
                const link = document.createElement('a');
                link.download = `styled-pfp-${window.overlayState.currentOverlay}.png`;
                link.href = newCanvas.toDataURL('image/png');
                link.click();
            }
        }
        
        // Close modals when clicking outside
        window.onclick = function(event) {
            const ottofyModal = document.getElementById('ottofyModal');
            const gameModal = document.getElementById('gameModal');
            const galleryModal = document.getElementById('galleryModal');
            const loreModal = document.getElementById('loreModal');
            if (event.target == ottofyModal) {
                closeOttofyModal();
            }
            if (event.target == gameModal) {
                closeGameModal();
            }
            if (event.target == galleryModal) {
                closeGalleryModal();
            }
            if (event.target == loreModal) {
                closeLoreModal();
            }
        }
    </script>
</body>
</html>
